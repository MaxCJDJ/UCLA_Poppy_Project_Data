---
title: "Data_Explore_V3"
format: html
---

```{r}
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 2. Load libraries
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
library(haven)     # read_sav()
library(dplyr)     # data wrangling
library(labelled)  # as_factor()
library(skimr)     # skim()
library(tidyr)     # pivot_longer()
library(naniar)    # vis_miss()
library(stringr)   # for str_replace_all()

# ðŸ”’ This file is not included in public repo
# sav_path <- "...sav"
sav_path <- "REDACTED.sav"

stop("âŒ Data not included in repo. Please provide your own SPSS file to continue.")
```

# 2. Define and check file path --------------------------------------------
```{r}
# 2. Check that the SPSS file exists before trying to read it
if (!file.exists(sav_path)) {
  # If the file isnâ€™t found, stop execution and print an error
  stop("âŒ File not found:\n  ", sav_path)
} else {
  # If the file exists, print a confirmation with its size in MB
  message("âœ… Found file (", 
          round(file.info(sav_path)$size / 1024^2, 1),
          " MB)\n")
}
```

# 3. Read SPSS data into a tibble ------------------------------------------
```{r}
# 3. Read the SPSS (.sav) file into R as a tibble (data frame)
df_tcwp <- read_sav(sav_path)
```

# 4. Basic structure & names -----------------------------------------------
```{r}
# 4. Inspect the dataâ€™s overall structure and column names

# Print the number of rows and columns
message("\n-- Dimensions --------------------------------------------------")
message(" Rows: ", nrow(df_tcwp), 
        " | Columns: ", ncol(df_tcwp), "\n")

# Show a compact â€œglimpseâ€ of the data (types and a preview of values)
message("-- Glimpse -----------------------------------------------------")
glimpse(df_tcwp)

# List all column names
message("\n-- Column names ------------------------------------------------")
print(colnames(df_tcwp))
```

# 5. Convert all labelled SPSS vars to factors ----------------------------
```{r}
# 5. Convert all SPSS-labelled variables into R factors
df_tcwp <- df_tcwp %>%
  mutate(
    # For every column that still uses havenâ€™s labelled class,
    # turn it into an R factor using the embedded value labels
    across(where(is.labelled), as_factor)
  )

# Confirm conversion by glimpsing the data again
message("\n-- After converting labelled â†’ factor --------------------------")
glimpse(df_tcwp)
```

# 6. Overall summary with skim() -------------------------------------------
```{r}
# 6. Provide a quick summary of every column with skimr
message("\n-- skimr summary -----------------------------------------------")
skim(df_tcwp)
```

# 7. Missingness overview --------------------------------------------------
```{r}
# 7. Compute missingness percentage for each variable
message("\n-- % Missing by variable ---------------------------------------")
missing_pct <- df_tcwp %>%
  # For each column, compute (NA count / total rows) * 100
  summarise(across(everything(), ~ mean(is.na(.)) * 100)) %>%
  # Pivot into long form for easy sorting and printing
  pivot_longer(
    everything(), 
    names_to  = "variable", 
    values_to = "pct_missing"
  ) %>%
  # Show variables with the most missing data at the top
  arrange(desc(pct_missing))

print(missing_pct)
```











